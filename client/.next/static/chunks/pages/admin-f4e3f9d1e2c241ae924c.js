(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[964],{13264:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return I}});var n=r(27791),a=r(22951),o=r(91976),s=r(47169),c=r(67591),i=r(68513),l=r(27597),d=r(64649),u=r(57135),h=r.n(u),f=r(27378),p=r(71074),w=r(15606),m=r(87137),x=r(27949),v=r(25773),j=r(24246),Z=function(e){var t=(0,v.Z)({},e),r=new Date(1e3*t.from),n=t.to?new Date(1e3*t.to):void 0,a=r.toLocaleDateString()+" "+r.toLocaleTimeString(),o=n?n.toLocaleDateString()+" "+n.toLocaleTimeString():"",s=t.reward,c=t.totalStaked,i=Math.round(1e5*s/(t.to-t.from))/1e5;return(0,j.jsxs)("tr",{children:[(0,j.jsxs)("td",{style:{textAlign:"center"},children:[" ",t.id," "]}),(0,j.jsxs)("td",{style:{textAlign:"center"},children:[" ",a," "]}),(0,j.jsxs)("td",{style:{textAlign:"center"},children:[" ",o," "]}),(0,j.jsxs)("td",{style:{textAlign:"right"},children:[" ",s," BIGPP"]}),(0,j.jsxs)("td",{style:{textAlign:"right"},children:[" ",i," BIGPP/s "]}),(0,j.jsxs)("td",{style:{textAlign:"right"},children:[" ",c," BIGPP "]})]},t.id)},g=r(67327),y=r(19087),P=r(52125),A=r(23907),D=r(75124),R=r(22648),C=r.n(R),b=r(84746);r(47846);function S(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,l.Z)(e);if(t){var a=(0,l.Z)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,i.Z)(this,r)}}var k=function(e){(0,c.Z)(r,e);var t=S(r);function r(e){var o;(0,a.Z)(this,r),o=t.call(this,e),(0,d.Z)((0,s.Z)(o),"updateAmount",(function(e){var t=parseInt(e.target.value),r=!isNaN(t)&&t>0;o.setState({validAmount:r,amount:e.target.value}),r&&o.checkAllowance(t).then((function(e){o.setState({sufficientAllowance:e})}))})),(0,d.Z)((0,s.Z)(o),"updateDate",(function(e,t){var r={};r[e]=t,o.setState(r)})),(0,d.Z)((0,s.Z)(o),"allowButtonPressed",(0,n.Z)(h().mark((function e(){var t;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=parseInt(o.state.amount),e.next=3,(0,b.dE)(t);case 3:o.checkAllowance(t).then((function(e){o.setState({sufficientAllowance:e})})),o.props.allowanceUpdated();case 5:case"end":return e.stop()}}),e)})))),(0,d.Z)((0,s.Z)(o),"checkAllowance",(function(e){return new Promise((function(t,r){(0,b.RC)().then((function(r,n){var a=parseInt(e)<=r;t(a)})).catch((function(e){console.error("Error checking allowance",e),r(e)}))}))})),(0,d.Z)((0,s.Z)(o),"submitForm",(function(){var e=o.state,t=e.amount,r=e.startDate,n=e.endDate,a=e.sufficientAllowance,s=e.validAmount;if(a)if(s){var c=parseInt(t);(0,y.Kb)(c,r,n).then((function(e){o.props.handleSuccess("New reward phase created. Transaction id: ".concat(e.tx))})).catch((function(e){console.log("Error 2 createRewardPhase:",e);var t=o.getRewardPeriodError(e);o.props.handleError(e,t)}))}else o.setState({error:"Invalid tolen amount"});else o.setState({error:"Insufficient token allowance"})})),(0,d.Z)((0,s.Z)(o),"getRewardPeriodError",(function(e){switch(!0){case e.message.includes("Invalid period start time"):return"Invalid period start time";case e.message.includes("Invalid reward amount"):return"Invalid reward amount";case e.message.includes("Invalid reward interval"):return"Invalid reward interval";default:return e.message}}));var c=e.startDate&&new Date(1e3*(e.startDate+1))||new Date,i=new Date(c.getTime()+6048e5);return o.state={sufficientAllowance:!1,validAmount:!1,startDate:c,endDate:i,amount:""},o}return(0,o.Z)(r,[{key:"render",value:function(){var e=this;return(0,j.jsxs)("div",{className:"p-2",children:[(0,j.jsx)("h3",{children:"New Reward Phase"}),(0,j.jsxs)(A.Z,{children:[(0,j.jsxs)(A.Z.Group,{className:"mb-3",controlId:"startDate",children:[(0,j.jsx)(A.Z.Label,{children:"Start Date"}),(0,j.jsx)(C(),{name:"startDate",className:"form-control datepicker",autoComplete:"off",onChange:function(t){return e.updateDate("startDate",t)},dateFormat:"yyyy-MM-dd",selected:this.state.startDate&&new Date(this.state.startDate)||null}),(0,j.jsx)(A.Z.Text,{className:"text-muted",children:"The date the reward phase start"})]}),(0,j.jsxs)(A.Z.Group,{className:"mb-3",controlId:"endDate",children:[(0,j.jsx)(A.Z.Label,{children:"End Date"}),(0,j.jsx)(C(),{name:"endDate",className:"form-control datepicker",autoComplete:"off",onChange:function(t){return e.updateDate("endDate",t)},dateFormat:"yyyy-MM-dd",selected:this.state.endDate&&new Date(this.state.endDate)||null}),(0,j.jsx)(A.Z.Text,{className:"text-muted",children:"The date the reward phase end"})]}),(0,j.jsxs)(A.Z.Group,{className:"mb-3",controlId:"rewardAmountt",children:[(0,j.jsx)(A.Z.Label,{children:"Amount"}),(0,j.jsxs)(D.Z,{className:"mb-3",children:[(0,j.jsx)(A.Z.Control,{style:{maxWidth:200},type:"text",placeholder:"0.0",autoComplete:"off",title:"Amount",onChange:function(t){return e.updateAmount(t)}}),(0,j.jsx)(D.Z.Text,{children:" BIGPP "})]})]}),(0,j.jsxs)("div",{style:{textAlign:"center"},className:"pt-2",children:[this.state.validAmount&&!this.state.sufficientAllowance&&(0,j.jsx)(m.Z,{name:"allow",type:"button",variant:"outline-primary",onClick:function(t){return e.allowButtonPressed()},className:"pl-2",children:"Allow BIGPP token transfer"}),"\xa0\xa0\xa0",(0,j.jsx)(m.Z,{variant:"outline-primary",onClick:this.submitForm,disabled:!(this.state.validAmount&&this.state.sufficientAllowance),children:"Submit"})]})]})]})}}]),r}(f.Component),N=r(82990);function E(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function O(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,l.Z)(e);if(t){var a=(0,l.Z)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,i.Z)(this,r)}}var I=function(e){(0,c.Z)(r,e);var t=O(r);function r(e){var o;return(0,a.Z)(this,r),o=t.call(this,e),(0,d.Z)((0,s.Z)(o),"headerRef",f.createRef()),(0,d.Z)((0,s.Z)(o),"setAccountConnected",(function(e){o.setState({accountConnected:e})})),(0,d.Z)((0,s.Z)(o),"toggleCreateRewardPhaseModal",(0,n.Z)(h().mark((function e(){var t;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=o.state.showCreateRewardPhaseModal,o.setState({showCreateRewardPhaseModal:!t});case 2:case"end":return e.stop()}}),e)})))),(0,d.Z)((0,s.Z)(o),"handleSuccess",(function(e){console.log(">>> handleSubmit done! values: ",e,"this.headerRef.",o.headerRef.current.reload),o.headerRef.current.reload(),o.reload(),o.setState({info:{title:"Success!",detail:e}})})),(0,d.Z)((0,s.Z)(o),"handleError",(function(e,t){console.log(">>> handleError",e,t),t?o.setState({error:t}):e.message?o.setState({error:e.message}):o.setState({error:"An error occurred (".concat(e.toString(),")")})})),o.state={showCreateRewardPhaseModal:!1,accountConnected:!1},o.headerRef=f.createRef(),o}return(0,o.Z)(r,[{key:"componentDidMount",value:function(){this.reload()}},{key:"reload",value:function(){console.log("reload AdminPage"),this.loadRewardPeriods()}},{key:"loadRewardPeriods",value:function(){var e=(0,n.Z)(h().mark((function e(){var t=this;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(0,y.GP)().then((function(e){t.setState({rewardPeriods:e.reverse()})})).catch((function(e){console.log(">>> error loading reward phases:",e),t.setState({error:e.message})}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"handleAllowanceUpdated",value:function(){var e=(0,n.Z)(h().mark((function e(){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log(">>> handleAllowanceUpdated"),this.headerRef.current.reload();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state,r=t.accountConnected,n=t.showCreateRewardPhaseModal,a=t.rewardPeriods;if(!r)return(0,j.jsxs)(g.T3,{children:[(0,j.jsx)(x.Z,{ref:this.headerRef,reload:function(){return e.reload()},setAccountConnected:function(t){return e.setAccountConnected(t)}}),(0,j.jsx)(g.M5,{children:(0,j.jsx)(p.Z,{variant:"info",title:"No Ethereum account connected",style:{textAlign:"center"},children:"Please connect an Ethereum account to access this dapp!"})})]});var o=a&&a.map((function(e,t){return(0,j.jsx)(Z,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?E(Object(r),!0).forEach((function(t){(0,d.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},e),e.id)})),s=this.state.rewardPeriods&&this.state.rewardPeriods.length>0&&this.state.rewardPeriods[0];return(0,j.jsxs)(g.T3,{children:[(0,j.jsx)(x.Z,{ref:this.headerRef,reload:function(){return e.reload()},setAccountConnected:function(t){return e.setAccountConnected(t)}}),n&&(0,j.jsx)(N.Z,{onClose:this.toggleCreateRewardPhaseModal,children:(0,j.jsx)(k,{handleSuccess:function(t){return e.handleSuccess(t)},handleError:function(t,r){return e.handleError(t,r)},allowanceUpdated:function(){return e.handleAllowanceUpdated()},startDate:s&&s.to})}),(0,j.jsxs)(g.M5,{children:[this.state.error&&(0,j.jsxs)(P.a,{variant:"danger",title:"Error",children:[" ",this.state.error," "]}),this.state.info&&(0,j.jsx)(P.a,{variant:"info",title:this.state.info.title,children:this.state.info.detail})]}),o&&0==o.length&&(0,j.jsx)(g.M5,{className:"mt-2",children:(0,j.jsx)(p.Z,{variant:"info",children:" No reward phase configured"})}),o&&o.length>0&&(0,j.jsx)(g.M5,{children:(0,j.jsxs)(w.Z,{responsive:!0,bordered:!0,striped:"on",children:[(0,j.jsx)("thead",{children:(0,j.jsxs)("tr",{children:[(0,j.jsx)("th",{children:"#"}),(0,j.jsx)("th",{children:"Start Date"}),(0,j.jsx)("th",{children:"End Date"}),(0,j.jsx)("th",{children:"Total Reward"}),(0,j.jsx)("th",{children:"Reward / sec"}),(0,j.jsx)("th",{children:"Currently Staked"})]})}),(0,j.jsx)("tbody",{children:o})]})}),(0,j.jsx)("div",{style:{textAlign:"center"},children:(0,j.jsx)(m.Z,{onClick:this.toggleCreateRewardPhaseModal,children:"Create New Reward Phase"})})]})}}]),r}(f.Component)},87267:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin",function(){return r(13264)}])}},function(e){e.O(0,[774,912,33,53,591,309,888,179],(function(){return t=87267,e(e.s=t);var t}));var t=e.O();_N_E=t}]);